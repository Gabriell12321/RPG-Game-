<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pesadelo Pixelado - RPG de Terror</title>
  <link rel="stylesheet" href="css/style.css">
  <style>
    .game-title {
      font-size: 2.5rem;
      color: #ff4444;
      text-shadow: 0 0 10px rgba(255, 0, 0, 0.8), 0 0 20px rgba(255, 0, 0, 0.6);
      margin-bottom: 20px;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }
    
    /* Efeito glitch na título */
    .game-title::before, .game-title::after {
      content: "Pesadelo Pixelado";
      position: absolute;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
    }
    
    .game-title::before {
      color: #0ff;
      z-index: -1;
      animation: glitch-effect 3s infinite alternate;
    }
    
    .game-title::after {
      color: #f0f;
      z-index: -2;
      animation: glitch-effect 2s infinite alternate-reverse;
    }
    
    @keyframes glitch-effect {
      0%, 5%, 10%, 100% { transform: translate(0); }
      1% { transform: translate(-2px, -2px); }
      2% { transform: translate(2px, 2px); }
      3% { transform: translate(-1px, 1px); }
      4% { transform: translate(1px, -1px); }
    }
  </style>
</head>
<body>
  <!-- Adicionando um título decorativo -->
  <div class="game-title">Pesadelo Pixelado</div>
  
  <div class="container" id="gameContainer">
    <div class="scanline"></div>
    <canvas id="screen"></canvas>
    <div class="info-bar">Controles: WASD = mover • ESPAÇO = atacar • E = interagir • F = lanterna • SHIFT = correr • ESC = menu • F11 = tela cheia</div>
    <div class="audio-controls">
      <button class="audio-btn" id="musicToggle">🔊 Música</button>
      <button class="audio-btn" id="sfxToggle">🔊 Sons</button>
      <button class="audio-btn" id="fullscreenToggle">⛶ Tela Cheia</button>
    </div>
  </div>
  
  <!-- Áudio (opcional - funcionará mesmo se não carregar) -->
  <audio id="bgMusic" loop preload="none" style="display: none;">
    <!-- Sem sources para evitar erros de carregamento -->
  </audio>
  <audio id="menuMove" preload="none" style="display: none;">
    <!-- Áudio sintético será usado -->
  </audio>
  <audio id="menuSelect" preload="none" style="display: none;">
    <!-- Áudio sintético será usado -->
  </audio>
  <audio id="doorSound" preload="none" style="display: none;">
    <!-- Som de porta abrindo -->
  </audio>
  <audio id="rainSound" loop preload="none" style="display: none;">
    <!-- Som visual da chuva apenas -->
  </audio>
  
  <!-- Informações sobre o jogo -->
  <div class="credits menu-only">
    <p>Um RPG de terror psicológico. Explore uma cidade abandonada, descubra segredos sombrios, 
      fuja de entidades sobrenaturais e lute por sua sanidade.</p>
    <p>A escuridão te observa - 2025</p>
  </div>
  
  <!-- Scripts do jogo -->
  <script>
    // Robust client-side diagnostics: script/resource errors + Promise rejections
    (function(){
      function appendOverlay(html){
        try {
          const el = document.createElement('div');
          el.style.cssText = 'color:red; background:black; padding:12px; margin:12px; font-family:monospace; white-space:pre-wrap; z-index:9999';
          el.innerHTML = html;
          document.body.appendChild(el);
        } catch (e) { console.error('Failed to append overlay', e); }
      }

      // JS runtime errors
      window.addEventListener('error', function(event) {
        // Resource loading errors (script/img/css) often have no event.error
        if (event.target && event.target !== window && event.target.tagName) {
          const tag = event.target.tagName.toLowerCase();
          const src = event.target.src || event.target.href || '(inline)';
          const msg = `Resource load error: <${tag}> ${src}`;
          console.error(msg, event);
          appendOverlay(`Error: ${msg}`);
          return;
        }
        const msg = (event.error && event.error.message) || event.message || 'Unknown error';
        const file = event.filename || window.__lastLoadingScript || 'unknown file';
        const line = event.lineno || 0;
        const col = event.colno || 0;
        const stack = (event.error && event.error.stack) ? ('\n' + event.error.stack) : '';
        console.error('Error caught:', msg, 'at', file, line, col, stack);
        appendOverlay(`Error: ${msg}\nFile: ${file}\nLine: ${line}, Column: ${col}${stack ? ('\n' + stack) : ''}`);
      }, true);

      // Unhandled Promise rejections
      window.addEventListener('unhandledrejection', function(event){
        const reason = event.reason || {};
        const msg = reason.message || String(reason) || 'Unhandled rejection';
        const stack = reason.stack ? ('\n' + reason.stack) : '';
        const src = window.__lastLoadingScript || 'unknown file';
        console.error('Unhandled rejection:', msg, stack);
        appendOverlay(`Unhandled Promise rejection: ${msg}\nSource: ${src}${stack ? ('\n' + stack) : ''}`);
      });
    })();
  </script>
  <!-- Scripts do jogo -->
  <script src="js/efeitos_visuais.js"></script>
  <script src="js/render_3d_effects.js"></script>
  <script src="js/lighting_advanced.js"></script>
  <script src="js/post_processing.js"></script>
  <script src="js/particle_system_advanced.js"></script>
  <script src="js/world_render_funcs.js"></script>
  <script src="js/world_render_effects.js"></script>
  <script src="js/world_render.js"></script>
  <script src="js/graphics_initializer.js"></script>
  <script src="personagens/personagemPrincipal.js"></script>
  <script src="personagens/animacoesAvancadas.js"></script>
  <script src="js/CharacterAnimations.js"></script>
  <script src="js/RenderizacaoJogador.js"></script>
  <script src="js/PlayerController.js"></script>
  <script src="js/LanternaSystem.js"></script>
  <script src="js/LightSourceManager.js"></script>
  <script src="js/LightingIntegration.js"></script>
  <script src="js/lighting_init.js"></script>
  <script src="personagens/mobs.js"></script>
  <script src="cutscene.js"></script>
  <script src="game_simple_new.js"></script>
  <script>
    // Integrar a cutscene com o jogo
    window.startGame = function() {
      // Função chamada pela cutscene quando terminar
      console.log('Cutscene finalizada, iniciando jogo...');
    };
    
    // Iniciar cutscene automaticamente
    document.addEventListener('DOMContentLoaded', function() {
      // Inicializar sistema de efeitos visuais
      if (window.EfeitosVisuais) {
        window.EfeitosVisuais.init();
        console.log('Sistema de efeitos visuais inicializado');
      }
      
      // Inicializar sistema de animações avançadas
      if (window.CharacterAnimations) {
        window.CharacterAnimations.init();
        console.log('Sistema de animações avançadas inicializado');
      }
      
      setTimeout(() => {
        // Auto-iniciar a cutscene após um breve delay
        if (window.CutsceneSystem && window.CutsceneSystem.start) {
          window.CutsceneSystem.start();
        }
      }, 1000);
    });
  </script>
</body>
</html>
